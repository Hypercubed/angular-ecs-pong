"use strict";angular.module("angularEcsPongApp",["ngAnimate","ngRoute","ngSanitize","ngTouch","hc.ngEcs"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("angularEcsPongApp").run(["ngEcs",function(a){function b(){this.x=0,this.y=0}function c(){this.element=null}a.$c("position",b),a.$c("impulse",b),a.$c("dom",c),a.$c("control",{speed:10}),a.$c("size",{height:0,width:0})}]),angular.module("angularEcsPongApp").run(["ngEcs",function(a){a.$s("controls",{keys:{},$require:["control","position"],changeKey:function(a,b){this.keys[a.keyCode]=b},$updateEach:function(a){this.keys[65]||this.keys[37]?a.position.x-=a.control.speed:(this.keys[68]||this.keys[39])&&(a.position.x+=a.control.speed)},$added:function(){var a=this,b=$(document);b.keydown(function(b){a.changeKey(b||window.event,!0)}),b.keyup(function(b){a.changeKey(b||window.event,!1)})}}),a.$s("size",{$require:["dom","size"],$addEntity:function(a){var b=$(a.dom.element);a.size.width=b.outerWidth(),a.size.height=b.outerHeight()}}),a.$s("impulse",{$require:["impulse","position"],$updateEach:function(a,b){a.position.x+=a.impulse.x*b,a.position.y+=a.impulse.y*b}}),a.$s("updatePosition",{$require:["position","dom"],$addEntity:function(a){var b=$(".jumbotron"),c=b.width(),d=b.height();b.width(c),b.height(d);var e=$(a.dom.element),f=e.position(),g=e.width(),h=e.height();a.position.x=c/2-g/2,a.position.y=f.top,e.css("top",0),e.css("left",0),e.css("right","auto"),e.css("bottom","auto"),e.width(g),e.height(h),e.css("position","absolute"),this.$render()},$render:function(){this.$family.forEach(function(a){$(a.dom.element).css("Transform","translate3d("+~~a.position.x+"px, "+~~a.position.y+"px, 0)")})}}),a.$s("collision",{score:0,screen:null,width:null,height:null,$added:function(){this.balls=a.families["impulse::position"],this.players=a.families["control::position"]},$started:function(){this.screen=$("#canvas"),this.width=this.screen.outerWidth(),this.height=this.screen.outerHeight()},$update:function(){var a=!1,b=this.balls[0],c=this.players[0],d=this.width-10,e=c.position.x,f=c.position.x+c.size.width,g=c.position.y;f>d?c.position.x=d-c.size.width:10>e&&(c.position.x=10);var h=b.position.x,i=b.position.x+b.size.width,j=b.position.y,k=b.position.y+b.size.height,l=k-g;if(l>0&&i>e&&f>h&&(b.impulse.y=-1.1*Math.abs(b.impulse.y),b.impulse.x=1.2*b.impulse.x,b.position.y-=l,this.score++),10>j?b.impulse.y=Math.abs(b.impulse.y):k>this.height&&(b.impulse.y=-Math.abs(b.impulse.y),a=!0),i>d?b.impulse.x=-Math.abs(b.impulse.x):10>h&&(b.impulse.x=Math.abs(b.impulse.x)),this.screen.css("background-color",a?"#FF5858":"#eee"),a){this.misses++,this.score=0,a=!1;var m=Math.sqrt(b.impulse.x*b.impulse.x+b.impulse.y*b.impulse.y);b.impulse.x=500*b.impulse.x/m,b.impulse.y=500*b.impulse.y/m}}})}]),angular.module("angularEcsPongApp").controller("MainCtrl",["$scope","ngEcs",function(a,b){var c=this;c.game=b,c.click=function(){b.$playing?(console.log("stop"),b.$stop()):(console.log("start"),b.$start())};var d=Math.PI*Math.random(),e=500;b.$e({dom:{element:$("#paddle")},size:{},position:{x:0,y:0},control:{}}),b.$e({dom:{element:$("#ball")},size:{},impulse:{x:e*Math.cos(d),y:e*Math.sin(d)},position:{x:0,y:0}})}]),angular.module("angularEcsPongApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);